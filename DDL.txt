-- Generated by Oracle SQL Developer Data Modeler 21.4.1.349.1605
--   at:        2022-01-22 17:38:19 CET
--   site:      Oracle Database 11g
--   type:      Oracle Database 11g



-- predefined type, no DDL - MDSYS.SDO_GEOMETRY

-- predefined type, no DDL - XMLTYPE

CREATE TABLE bilety (
    id_biletu        INTEGER NOT NULL,
    fotele_fotel_id  INTEGER NOT NULL,
    cena             NUMBER(5, 2) NOT NULL,
    seanse_id_seansu INTEGER NOT NULL
);

ALTER TABLE bilety ADD CONSTRAINT bilety_pk PRIMARY KEY ( id_biletu );

CREATE TABLE filmy (
    id_filmu      INTEGER NOT NULL,
    tytul_filmu   VARCHAR2(30 CHAR) NOT NULL,
    data_premiery DATE NOT NULL,
    jezyk_typ     VARCHAR2(20 CHAR) NOT NULL
);

ALTER TABLE filmy ADD CONSTRAINT filmy_pk PRIMARY KEY ( id_filmu );

CREATE TABLE fotele (
    fotel_id          INTEGER NOT NULL,
    sala              INTEGER NOT NULL,
    rzad              CHAR(1 CHAR) NOT NULL,
    miejsce_w_rzedzie INTEGER NOT NULL
);

ALTER TABLE fotele ADD CONSTRAINT fotel_pk PRIMARY KEY ( fotel_id );

CREATE TABLE nagrody (
    id_nagrody               INTEGER NOT NULL,
    opis                     VARCHAR2(2000 CHAR) NOT NULL,
    data_waznosci            DATE NOT NULL,
    stali_klienci_id_klienta INTEGER
);

ALTER TABLE nagrody ADD CONSTRAINT nagrody_pk PRIMARY KEY ( id_nagrody );

CREATE TABLE paragony (
    id_paragonu              INTEGER NOT NULL,
    stali_klienci_id_klienta INTEGER,
    kwota                    NUMBER(8, 2) NOT NULL,
    id_biletu                INTEGER NOT NULL
);

ALTER TABLE paragony ADD CONSTRAINT kwota_nieujemna CHECK ( kwota >= 0 );

ALTER TABLE paragony ADD CONSTRAINT paragon_pk PRIMARY KEY ( id_paragonu );

CREATE TABLE pracownicy (
    pesel    INTEGER NOT NULL,
    imie     VARCHAR2(20) NOT NULL,
    nazwisko VARCHAR2(30) NOT NULL
);

ALTER TABLE pracownicy
    ADD CONSTRAINT pesel_len CHECK ( pesel > 9999999999
                                     AND pesel < 100000000000 );

ALTER TABLE pracownicy ADD CONSTRAINT pracownik_pk PRIMARY KEY ( pesel );

CREATE TABLE pracownicy_zespoly (
    zespoly_id_zesp INTEGER NOT NULL,
    pracownik_pesel INTEGER NOT NULL
);

ALTER TABLE pracownicy_zespoly ADD CONSTRAINT relation_3_pk PRIMARY KEY ( pracownik_pesel,
                                                                          zespoly_id_zesp );

CREATE TABLE produkty (
    kod_kreskowy INTEGER NOT NULL,
    opis         VARCHAR2(200 CHAR),
    cena         NUMBER(7, 2) NOT NULL,
    nazwa        VARCHAR2(30 CHAR) NOT NULL
);

ALTER TABLE produkty ADD CONSTRAINT cena_nieujemna_produktu CHECK ( cena >= 0 );

ALTER TABLE produkty ADD CONSTRAINT produkty_pk PRIMARY KEY ( kod_kreskowy );

CREATE TABLE produkty_paragony (
    paragon_id_paragonu   INTEGER NOT NULL,
    produkty_kod_kreskowy INTEGER NOT NULL
);

ALTER TABLE produkty_paragony ADD CONSTRAINT relation_13_pk PRIMARY KEY ( paragon_id_paragonu,
                                                                          produkty_kod_kreskowy );

CREATE TABLE rabaty (
    nazwa       VARCHAR2(50 CHAR) NOT NULL,
    proc_znizki INTEGER NOT NULL,
    dla_kogo    VARCHAR2(300 CHAR)
);

ALTER TABLE rabaty ADD CONSTRAINT znizka_max_100 CHECK ( proc_znizki <= 100 );

ALTER TABLE rabaty ADD CONSTRAINT znizka_nieujemna CHECK ( proc_znizki >= 0 );

ALTER TABLE rabaty ADD CONSTRAINT rabat_pk PRIMARY KEY ( nazwa );

CREATE TABLE rabaty_bilety (
    rabat_nazwa      VARCHAR2(50 CHAR) NOT NULL,
    bilet_id_biletu  INTEGER NOT NULL,
    bilety_id_biletu INTEGER NOT NULL
);

ALTER TABLE rabaty_bilety
    ADD CONSTRAINT relation_15_pk PRIMARY KEY ( rabat_nazwa,
                                                bilet_id_biletu,
                                                bilety_id_biletu );

CREATE TABLE seanse (
    id_seansu       INTEGER NOT NULL,
    godzina_start   DATE NOT NULL,
    godzina_stop    DATE NOT NULL,
    zespoly_id_zesp INTEGER NOT NULL,
    filmy_id_filmu  INTEGER NOT NULL
);

ALTER TABLE seanse ADD CONSTRAINT czas_start_przed_czas_stop CHECK ( godzina_start < godzina_stop );

ALTER TABLE seanse ADD CONSTRAINT seans_pk PRIMARY KEY ( id_seansu );

CREATE TABLE stali_klienci (
    id_klienta      INTEGER NOT NULL,
    imie            VARCHAR2(20 CHAR) NOT NULL,
    nazwisko        VARCHAR2(20 CHAR) NOT NULL,
    data_dolaczenia DATE NOT NULL
);

ALTER TABLE stali_klienci ADD CONSTRAINT staly_klient_pk PRIMARY KEY ( id_klienta );

CREATE TABLE zespoly (
    id_zesp INTEGER NOT NULL
);

ALTER TABLE zespoly ADD CONSTRAINT zespoly_pk PRIMARY KEY ( id_zesp );

ALTER TABLE bilety
    ADD CONSTRAINT bilety_fotele_fk FOREIGN KEY ( fotele_fotel_id )
        REFERENCES fotele ( fotel_id );

ALTER TABLE bilety
    ADD CONSTRAINT bilety_paragony_fk FOREIGN KEY ( seanse_id_seansu )
        REFERENCES seanse ( id_seansu );

ALTER TABLE nagrody
    ADD CONSTRAINT nagrody_stali_klienci_fk FOREIGN KEY ( stali_klienci_id_klienta )
        REFERENCES stali_klienci ( id_klienta );

ALTER TABLE paragony
    ADD CONSTRAINT paragony_bilety_fk FOREIGN KEY ( id_biletu )
        REFERENCES bilety ( id_biletu );

ALTER TABLE paragony
    ADD CONSTRAINT paragony_stali_klienci_fk FOREIGN KEY ( stali_klienci_id_klienta )
        REFERENCES stali_klienci ( id_klienta );

ALTER TABLE pracownicy_zespoly
    ADD CONSTRAINT pracownicy_zespoly_zespoly_fk FOREIGN KEY ( zespoly_id_zesp )
        REFERENCES zespoly ( id_zesp );

ALTER TABLE rabaty_bilety
    ADD CONSTRAINT rabaty_bilety_bilety_fk FOREIGN KEY ( bilety_id_biletu )
        REFERENCES bilety ( id_biletu );

ALTER TABLE produkty_paragony
    ADD CONSTRAINT relation_13_paragon_fk FOREIGN KEY ( paragon_id_paragonu )
        REFERENCES paragony ( id_paragonu );

ALTER TABLE produkty_paragony
    ADD CONSTRAINT relation_13_produkty_fk FOREIGN KEY ( produkty_kod_kreskowy )
        REFERENCES produkty ( kod_kreskowy );

ALTER TABLE rabaty_bilety
    ADD CONSTRAINT relation_15_rabat_fk FOREIGN KEY ( rabat_nazwa )
        REFERENCES rabaty ( nazwa );

ALTER TABLE pracownicy_zespoly
    ADD CONSTRAINT relation_3_pracownik_fk FOREIGN KEY ( pracownik_pesel )
        REFERENCES pracownicy ( pesel );

ALTER TABLE seanse
    ADD CONSTRAINT seanse_filmy_fk FOREIGN KEY ( filmy_id_filmu )
        REFERENCES filmy ( id_filmu );

ALTER TABLE seanse
    ADD CONSTRAINT seanse_zespoly_fk FOREIGN KEY ( zespoly_id_zesp )
        REFERENCES zespoly ( id_zesp );



-- Oracle SQL Developer Data Modeler Summary Report: 
-- 
-- CREATE TABLE                            14
-- CREATE INDEX                             0
-- ALTER TABLE                             33
-- CREATE VIEW                              0
-- ALTER VIEW                               0
-- CREATE PACKAGE                           0
-- CREATE PACKAGE BODY                      0
-- CREATE PROCEDURE                         0
-- CREATE FUNCTION                          0
-- CREATE TRIGGER                           0
-- ALTER TRIGGER                            0
-- CREATE COLLECTION TYPE                   0
-- CREATE STRUCTURED TYPE                   0
-- CREATE STRUCTURED TYPE BODY              0
-- CREATE CLUSTER                           0
-- CREATE CONTEXT                           0
-- CREATE DATABASE                          0
-- CREATE DIMENSION                         0
-- CREATE DIRECTORY                         0
-- CREATE DISK GROUP                        0
-- CREATE ROLE                              0
-- CREATE ROLLBACK SEGMENT                  0
-- CREATE SEQUENCE                          0
-- CREATE MATERIALIZED VIEW                 0
-- CREATE MATERIALIZED VIEW LOG             0
-- CREATE SYNONYM                           0
-- CREATE TABLESPACE                        0
-- CREATE USER                              0
-- 
-- DROP TABLESPACE                          0
-- DROP DATABASE                            0
-- 
-- REDACTION POLICY                         0
-- 
-- ORDS DROP SCHEMA                         0
-- ORDS ENABLE SCHEMA                       0
-- ORDS ENABLE OBJECT                       0
-- 
-- ERRORS                                   0
-- WARNINGS                                 0
